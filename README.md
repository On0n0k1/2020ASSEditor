
    # I used a subtitle file generated by the website aegisub, which is 100x better than myne. Please consider 
    # supporting them. I'm only making this project to add to my curriculum. No intention of finishing
    # I wrote a lot more here yesterday. But accidentaly told git to pull instead of push what was written...

# 2020ASSEditor
Editor for SubStation Alpha (.ass) format subtitle files. First main reason for this project is to add to my curriculum.
Second main reason is for it to be easy to expand and read. Third main reason is for it to be a good example to use for 
any python learner wanting to check on a larger project. Even with 4000 lines of code, most of what this code is doing 
is treating 'strings and numbers' in a useful way. It takes a large piece of text, splits into each of the individual 
useful pieces of data and store them to be modified however the user wants.

The number of lines doesn't get in the way in terms of understanding what it does. There are the 'macro' objects 
(ScriptInfo, V4Styles and Events), and the 'micro' objects that extend them. Each of these objects encompasses their own
scope. And only 'higher' objects have methods that interfere with the parts that they contain. I.E. V4Styles have a list
of Styles ("Estilo"), each style doesn't intefere with one another. But V4Styles have methods that may use or change 
each individual Style ("Estilo").

More tools for editing these values will be added later. There's no UI planned for this software at the moment. But 
there are expectations for adding multiprocessing and more practical methods for all the objects. As in: instead of 
checking element individually. Calling only one method to change all the elements we want to change. Developer Note: I'm 
delaying this until I can make an implementation that use the Ray multiprocessing framework.
 
Hopefully this readme will be useful in clearing every question the readers might have about the software.


## How to use the code
There's a 'download zip' bottom up there. But I prefer just using git instead.

- Install git
- Open command prompt
- Go to an empty folder that you want to copy using ls and cd
- Do:
- git clone https://github.com/On0n0k1/2020ASSEditor.git

## How it works
A .ass file is divided into 3 main sections:
* Script Info: File header and metadata
* V4+ Styles: Font and text styles that may be used by the subtitles
* Events: Every event that happens during the video. Include subtitles, but may also have other effects like pictures or
video. 

There is a folder for each one of these sections inside the folder 'Dados'. Each of these folders will also have the 
class definitions for the elements they may have.

Apart from these 3 main classes, there's one more with the name "SimpleLine". This object is intended to receive a 
String line and check if it is in the format "{Type}:{Text}". If it's not, Type will be None and Text will be the whole 
line. This class saves up a lot of code. And is used by the other classes when reading or saving the file.

V4Styles and Events both need a line named "Format: ". This line tells what each column stores. Currently, if the 
project read a Style or Event without reading "Format:", it will raise an exception. V4Styles doesn't have a limited 
number of columns, but Events will always have 10 columns. Last column in Events must always be Text, so that it can 
receive subsequent ',' as just part of it.

Couldn't find clear documentation on what each of the columns in Styles are for. So just reading Strings. Couldn't find 
clear documentation on what types of ScriptInfo headers may be read. So just reading Strings as well. Couldn't find 
clear documentation on Event effects like Karaoke. So it's basically an empty object that prints as "Karaoke". There is 
documentation on what commands we can add on Text, but implementing code for understanding each one individually will 
cost a few hundreds of code lines. So just reading an object that store a String.

Because of this, I ran into a wall after spending a reasonable amount of time writing a lot of code. Didn't want to 
throw everything away and start from scratch with another project. So I'm keeping this project here just to help people 
with understanding some of Python's core tools. Like my friends in my university.

There are some classes people may find interesting. I really recommend taking a look on the 'Timing' class. It is 
located in '\Dados\Events\Eventos\Timing.py'. It prints time in the format "H:MM:SS.CS". It can be turned into integer 
as centiseconds. It can be turned into float as seconds. It also supports operations with integers and float. As well as  
comparisons with these values. The file can be compiled directly. And it will run several lines of assert operations to 
make sure that all the comparisons and operations will work properly.

To summarize. SubPackage will use ScriptInfo, V4Styles and Events. When it reads a file, it will distribute each piece 
of the text to it's children. For printing and saving, it will call it's children String formats too. Each object can be 
incremented with more tools without making the rest of the code less readable. Later I will add the JSON for each of the
objects below.

## How to contribute
Until I get a job in development, I intend to not take contributions for the time being. Just to make sure that the 
reader can see what I know in practice. As soon as I get a job and start getting more experience, I will allow others 
to support this code's development.

Nothing stops you from downloading this code and developing yourself. I just ask for credit in that case. My name is 
Lucas Alessandro do Carmo Lemos, and my github account name is On0n0k1. I'm very grateful for those who use and mention
the source.


## Developer Extra Note
The individual parts of the code are working. But since the process is limited to a single core, It is annoying to wait 
for it through the CPU-intensive part of the process where it is going through all the subtitles checking and changing 
all the wanted elements. If it takes 0.5 seconds for each subtitle to be edited, a file with 600 lines would take 5 
minutes to finish. Which is unacceptable when the time can be divided by the number of CPU cores available on the 
system.

My computer has 8 cores. There are processors with 64 cores out already. There's no way to not use multiprocessing here
if it means pushing 300 seconds to 37.5 seconds or 4.68 seconds using the same code.

For Python, we can't simply multithread the program due to the Global Interlocking Cooldown (GIL). GIL forces only one 
processor to access an individual instance of the code at the time. In order to take the best of the CPU, multiple 
processes should be used instead.

At first I thought about using Python's Multiprocessing module. But the more I learned about the module, and the more I 
used it, more issues end up emerging. Here are the worst bottlenecks I found:

* Arguments for functions that are being used in multiprocessing must be picklable. Which makes code lose a lot of the 
traits that made Python so practical as a language. There's "duct tape" code to fix that though.

* In the current version docs (3.8.6) for multiprocessing, it is admitted that using fork "context and start" method 
may cause some issues. Good luck trying to find "what" errors may rise from using it. Fork is default for Unix systems.

* All Multiprocessing calls need to be "protected" inside an 'if \_\_name\_\_ == "\_\_main\_\_"' clause.

I wanted to create an iterator of methods that are eligible. Create a process that gets a function from this iterator.
Do the operation. Return the result. And another process assigns the result to the main objects. A single method that 
do all of this. But since it must be picklable. Generators, function objects, lambda objects and many other tools can't 
be used. If the main tools for Python are not available, why not just code with c++ instead?

From this I hope it is understandable that the code would be way too hard to read and use properly. Which is why I'm 
currently learning how to use Ray framework. Updates will come later.



